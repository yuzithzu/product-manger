<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Product Manager & Materials Pricing Calculator</title>
  <style>
    :root{
      --bg:#0f1724; --card:#0b1220; --muted:#94a3b8; --accent:#6ee7b7; --glass: rgba(255,255,255,0.04);
      --glass-2: rgba(255,255,255,0.02); --danger:#ff6b6b; --soft:#111827;
    }
    *{box-sizing:border-box}
    body{font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; margin:0; background:linear-gradient(180deg,#071024 0%, #071032 100%); color:#e6eef8;}
    .wrap{max-width:1200px; margin:28px auto; padding:20px;}
    header{display:flex; gap:16px; align-items:center; margin-bottom:18px}
    header h1{font-size:20px; margin:0}
    .grid{display:grid; gap:18px; grid-template-columns:1fr 1fr}
    @media (max-width:900px){.grid{grid-template-columns:1fr}}

    /* Card */
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:14px; padding:18px; box-shadow:0 6px 18px rgba(2,6,23,0.6); border:1px solid rgba(255,255,255,0.03)}
    .card h2{margin:0 0 8px 0; font-size:16px}
    .muted{color:var(--muted); font-size:13px}

    /* product manager */
    .controls{display:flex; gap:8px; flex-wrap:wrap}
    .controls input[type=text], .controls input[type=number]{background:transparent; border:1px solid rgba(255,255,255,0.06); padding:10px 12px; border-radius:10px; color:inherit}
    .btn{background:linear-gradient(90deg,var(--accent), #3dd6b6); border:none; padding:10px 12px; border-radius:10px; color:#042018; font-weight:600; cursor:pointer; transition: all 0.1s ease;}
    .btn.ghost{background:transparent; color:var(--accent); border:1px solid rgba(255,255,255,0.04)}
    .btn:active { transform: scale(0.97); }
    .small{padding:8px 10px; font-size:14px}

    /* list */
    /* --- AYOS 2: Ginawang 320px para pumantay sa kabilang card --- */
    .list{margin-top:12px; max-height:320px; overflow:auto; padding-right:6px}
    .item{display:flex; gap:10px; align-items:center; padding:10px; border-radius:10px; margin-bottom:8px; background:var(--glass);}
    .item .title{flex:1}
    .price{font-weight:700}

    /* calculator */
    .table{width:100%; border-collapse:collapse}
    .table thead th{font-size:13px; text-align:left; color:var(--muted); padding-bottom:8px}
    .table td{padding:8px 6px}
    .table input{width:100%; background:transparent; border:1px solid rgba(255,255,255,0.03); padding:8px; border-radius:8px; color:inherit}
    .rows{max-height:320px; overflow:auto; margin-top:12px}
    /* --- AYOS 2: Nagdagdag ng class para sa row alignment --- */
    .calc-row {
      display:flex; 
      gap:8px; 
      align-items:center; 
      padding:8px 0; 
      margin-bottom:8px;
    }
    .row-actions{display:flex; gap:8px; justify-content: flex-start;}
    .row-actions button{padding:6px 10px; font-size:13px}

    .bottom{display:flex; gap:12px; align-items:center; justify-content:space-between; margin-top:12px}
    .calc-summary{min-width:220px}

    /* responsive niceties */
    footer{margin-top:22px; text-align:center; color:var(--muted); font-size:13px}

    /* small helpers */
    .chip{background:var(--glass-2); padding:6px 8px; border-radius:8px; font-size:13px}
    .danger{background:linear-gradient(90deg, #ff8a8a, #ff6b6b); color:#fff}

    /* scrollbars */
    .list::-webkit-scrollbar, .rows::-webkit-scrollbar{width:8px}
    .list::-webkit-scrollbar-thumb, .rows::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.04); border-radius:8px}
    
    /* Material selector styling */
    .material-select {
      background: var(--glass);
      border: 1px solid rgba(255,255,255,0.06);
      padding: 8px;
      border-radius: 8px;
      color: inherit;
      width: 100%;
    }
    
    /* Improved markup display */
    .markup-section {
      background: var(--glass-2);
      border-radius: 10px;
      padding: 12px;
      margin-top: 10px;
      width: 100%;
    }
    
    .markup-item {
      display: flex;
      justify-content: space-between;
      padding: 6px 0;
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }
    
    .markup-item:last-child {
      border-bottom: none;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div style="display:flex;flex-direction:column">
        <h1>ðŸ›’ Product Manager â€” Saved in Local Storage</h1>
        <span class="muted">Responsive, mobile-friendly dashboard â€” automatic saving</span>
      </div>
      <div style="margin-left:auto" class="chip">Auto-save: ON</div>
    </header>

    <div class="grid">
      <section class="card" id="productsCard">
        <h2>Product Manager</h2>
        <p class="muted">Mag-add o i-update ang product. Ang mga produkto ay naka-save sa iyong browser.</p>

        <div style="margin-top:12px" class="controls">
          <input id="productName" type="text" placeholder="Product name (e.g. angelo)" />
          <input id="productPrice" type="number" step="0.01" placeholder="Price (â‚±)" />
          <button id="addUpdateBtn" class="btn small">Add / Update Product</button>
          <button id="clearAllBtn" class="btn ghost small">Clear All</button>
        </div>

        <div style="margin-top:12px; display:flex; gap:8px; align-items:center">
          <button id="deleteSelectedBtn" class="btn small danger">Delete Selected</button>
          <div class="muted" style="margin-left:auto">Total products: <span id="totalCount">0</span></div>
        </div>

        <div class="list" id="productList" aria-live="polite">
          </div>
      </section>

      <section class="card">
        <h2>ðŸ“˜ Materials Pricing Calculator</h2>
        <p class="muted">Maglagay ng materials at awtomatikong kakalkulahin ang per-sheet price, total, tax at markup.</p>

        <table class="table" style="width:100%; margin-top:12px">
          <thead>
            <tr>
              <th style="width:25%">Materials</th>
              <th style="width:10%">Pcs</th>
              <th style="width:30%">Description</th>
              <th style="width:10%">Price</th>
              <th style="width:10%">Per Sheet</th>
              <th style="width:15%">Actions</th>
            </tr>
          </thead>
        </table>

        <div class="rows" id="rowsContainer">
          </div>

        <div style="margin-top:10px; display:flex; gap:8px">
          <button id="addRowBtn" class="btn small">+ Add Row</button>
          <div style="margin-left:auto; display:flex; gap:8px; align-items:center">
            <label class="muted">Tax (â‚±):</label>
            <input id="taxInput" type="number" step="0.01" value=".8" style="width:90px" />
          </div>
        </div>

        <div class="bottom">
          <div class="calc-summary">
            <div class="muted">Total Materials:</div>
            <div style="font-weight:700; font-size:18px;">â‚± <span id="materialsTotal">0.00</span></div>
            <div class="muted" style="margin-top:8px">Total + Tax:</div>
            <div style="font-weight:700; font-size:16px;">â‚± <span id="totalWithTax">0.00</span></div>
          </div>

          <div class="markup-section">
            <div class="muted">Markup Computations</div>
            <div id="markupContainer">
              </div>
          </div>
        </div>

      </section>
    </div>

    <footer>Built for mobile & desktop Â· Scrollable lists Â· LocalStorage autosave</footer>
  </div>

  <script>
    // --- helper
    const fmt = (n)=> Number(n||0).toLocaleString(undefined,{minimumFractionDigits:2, maximumFractionDigits:2});

    // --- Product Manager ---
    const productName = document.getElementById('productName');
    const productPrice = document.getElementById('productPrice');
    const addUpdateBtn = document.getElementById('addUpdateBtn');
    const clearAllBtn = document.getElementById('clearAllBtn');
    const productList = document.getElementById('productList');
    const deleteSelectedBtn = document.getElementById('deleteSelectedBtn');
    const totalCount = document.getElementById('totalCount');

    const PRODUCTS_KEY = 'pm_products_v1';
    let products = JSON.parse(localStorage.getItem(PRODUCTS_KEY) || '[]');

    function saveProducts(){ 
      localStorage.setItem(PRODUCTS_KEY, JSON.stringify(products)); 
      renderProducts(); 
      renderRows();
      computeAll();
    }

    function renderProducts(){
      productList.innerHTML='';
      products.forEach((p, idx)=>{
        const el = document.createElement('div'); 
        el.className='item';
        el.innerHTML = `<input type="checkbox" data-index="${idx}" />
          <div class="title">
            <div style="font-weight:700">${escapeHtml(p.name || '(no name)')}</div>
            <div class="muted" style="font-size:13px">${escapeHtml(p.desc||'')}</div>
          </div>
          <div class="price">â‚± ${fmt(p.price)}</div>
          <div style="margin-left:8px">
            <button class="btn ghost small" data-edit="${idx}">Edit</button>
          </div>`;
        productList.appendChild(el);
      });
      totalCount.textContent = products.length;
      productList.querySelectorAll('[data-edit]').forEach(btn=> {
        btn.addEventListener('click', (e)=>{
          const i = Number(btn.getAttribute('data-edit'));
          productName.value = products[i].name; 
          productPrice.value = products[i].price;
          addUpdateBtn.textContent = 'Update Product'; 
          addUpdateBtn.dataset.editIndex = i;
        })
      })
    }

    addUpdateBtn.addEventListener('click', ()=>{
      const name = productName.value.trim();
      const price = parseFloat(productPrice.value) || 0;
      if(!name){ alert('Please enter product name.'); return; }
      if(addUpdateBtn.dataset.editIndex !== undefined){
        const idx = Number(addUpdateBtn.dataset.editIndex);
        products[idx] = {name, price};
        delete addUpdateBtn.dataset.editIndex; 
        addUpdateBtn.textContent='Add / Update Product';
      } else {
        products.push({name, price});
      }
      productName.value=''; 
      productPrice.value=''; 
      saveProducts();
    })

    deleteSelectedBtn.addEventListener('click', ()=>{
      const boxes = Array.from(productList.querySelectorAll('input[type=checkbox]'));
      const removeIdx = boxes.filter(b=>b.checked).map(b=>Number(b.dataset.index)).sort((a,b)=>b-a);
      if(removeIdx.length===0){ alert('No selection'); return; }
      for(const i of removeIdx) products.splice(i,1);
      saveProducts();
    })

    clearAllBtn.addEventListener('click', ()=>{
      if(confirm('Clear all products?')){ 
        products=[]; 
        saveProducts(); 
      }
    })

    function escapeHtml(s){ 
      return String(s).replace(/[&<>\"']/g, (c)=>({ 
        '&':'&amp;',
        '<':'&lt;',
        '>':'&gt;',
        '\"':'&quot;',
        "'":'&#39;' 
      })[c]); 
    }

    renderProducts();

    // --- Materials Pricing Calculator ---
    const rowsContainer = document.getElementById('rowsContainer');
    const addRowBtn = document.getElementById('addRowBtn');
    const taxInput = document.getElementById('taxInput');
    const materialsTotalEl = document.getElementById('materialsTotal');
    const totalWithTaxEl = document.getElementById('totalWithTax');
    const markupContainer = document.getElementById('markupContainer');

    const ROWS_KEY = 'pm_materials_v1';
    let rows = JSON.parse(localStorage.getItem(ROWS_KEY) || '[]');

    function saveRows(){ 
      localStorage.setItem(ROWS_KEY, JSON.stringify(rows)); 
      computeAll(); 
    }

    function computePerSheet(price, pcs){ 
      pcs = Number(pcs) || 1; 
      return pcs===0?0: (Number(price||0)/pcs); 
    }

    function renderRows(){ 
      rowsContainer.innerHTML='';
      rows.forEach((r, i)=>{
        const row = document.createElement('div'); 
        row.className = 'calc-row'; // --- AYOS 2: Ginamit ang class
        
        let materialOptions = '<option value="">Select a product</option>';
        products.forEach((product, idx) => {
          const isSelected = r.materialId === idx;
          materialOptions += `<option value="${idx}" ${isSelected ? 'selected' : ''}>${escapeHtml(product.name)} (â‚±${fmt(product.price)})</option>`;
        });
        
        // --- AYOS 2: Inayos ang widths para pumantay sa <th> ---
        row.innerHTML = `
          <select data-i="${i}" class="material-select r-material" style="width:25%">
            ${materialOptions}
          </select>
          <input data-i="${i}" class="r-pcs r-input" type="number" min="0" value="${r.pcs||10}" style="width:10%" />
          <input data-i="${i}" class="r-desc r-input" placeholder="description" value="${escapeHtml(r.desc||'')}" style="width:30%" />
          <input data-i="${i}" class="r-price r-input" type="number" step="0.01" value="${r.price||0}" style="width:10%" />
          <div style="width:10%; font-weight:700; padding: 0 4px;">â‚± <span class="per-sheet">${fmt(computePerSheet(r.price, r.pcs))}</span></div>
          <div class="row-actions" style="width:15%">
            <button class="btn ghost small" data-save="${i}">Save</button>
            <button class="btn ghost small" data-delete="${i}">Delete</button>
          </div>
        `;
        rowsContainer.appendChild(row);
      });

      // attach handlers
      rowsContainer.querySelectorAll('[data-save]').forEach(b=> {
        b.addEventListener('click', ()=>{
          // --- AYOS 1: Ang 'Save' button ay nagse-save na lang sa localStorage.
          // Ang pag-update ng 'rows' array ay nangyayari na live via 'input' listener.
          localStorage.setItem(ROWS_KEY, JSON.stringify(rows));
          b.textContent = 'Saved!';
          setTimeout(() => { b.textContent = 'Save'; }, 1000);
        });
      });

      rowsContainer.querySelectorAll('[data-delete]').forEach(b=> {
        b.addEventListener('click', ()=>{
          const i = Number(b.getAttribute('data-delete'));
          if(confirm('Delete this material row?')){ 
            rows.splice(i,1); 
            renderRows(); // I-render ulit para ma-update ang UI
            saveRows(); // I-save ang pagbabago (pagka-delete)
          }
        });
      });

      rowsContainer.querySelectorAll('.r-material').forEach(select => {
        select.addEventListener('change', (e) => {
          const i = Number(e.target.dataset.i);
          const materialIndex = Number(e.target.value);
          
          if (!isNaN(materialIndex) && materialIndex >= 0 && products[materialIndex]) {
            rows[i].name = products[materialIndex].name;
            rows[i].price = products[materialIndex].price;
            rows[i].materialId = materialIndex;
            
            const container = e.target.closest('.calc-row');
            const priceInput = container.querySelector('.r-price');
            if (priceInput) priceInput.value = products[materialIndex].price;
            
            // --- AYOS 1: Awtomatikong i-save at i-compute kapag pumili ng material
            saveRows();
          }
        });
      });
      
      // --- AYOS 1: Pinagsama ang lahat ng input listeners
      // Live na ina-update ang 'rows' array at nagco-compute
      rowsContainer.querySelectorAll('.r-pcs, .r-price, .r-desc').forEach(input => {
        input.addEventListener('input', (e) => {
          const i = Number(e.target.dataset.i);
          if (rows[i] === undefined) return; 

          const container = e.target.closest('.calc-row');
          if (!container) return;
          
          // Kunin ang live values mula sa inputs
          const priceVal = Number(container.querySelector('.r-price').value) || 0;
          const pcsVal = Number(container.querySelector('.r-pcs').value) || 0;
          const descVal = container.querySelector('.r-desc').value;

          // I-update agad ang 'rows' array sa memorya
          rows[i].price = priceVal;
          rows[i].pcs = pcsVal;
          rows[i].desc = descVal;
          
          // Awtomatikong i-recompute ang lahat (Per Sheet, Totals, at Markup)
          computeAll();
        });
      });
    }

    // --- AYOS 1: Hiniwalay ang pag-compute ng totals
    function computeTotalsOnly() {
      let total = 0;
      rows.forEach((r,i)=>{ 
        total += Number(r.price||0); 
        // I-update din ang 'Per Sheet' display habang naglo-loop
        const per = computePerSheet(r.price, r.pcs); 
        const el = rowsContainer.querySelectorAll('.per-sheet')[i]; 
        if(el) el.textContent = fmt(per); 
      });
      const tax = Number(taxInput.value) || 0;
      materialsTotalEl.textContent = fmt(total);
      totalWithTaxEl.textContent = fmt(total + tax);
    }
    
    // --- AYOS 1: Ito na ang main function na tumatawag sa lahat ng computations
    function computeAll(){
      computeTotalsOnly();
      computeMarkupForAll();
    }

    function computeMarkupForAll(){
      markupContainer.innerHTML = '';
      if (rows.length === 0) {
        markupContainer.innerHTML = '<div class="muted">No rows to compute</div>';
        return;
      }
      
      rows.forEach((row, i) => {
        const base = Number(row.price || 0);
        const markup10 = base * 0.1;
        const markup20 = base * 0.2;
        const markup30 = base * 0.3;
        
        const markupDiv = document.createElement('div');
        markupDiv.className = 'markup-item';
        markupDiv.innerHTML = `
          <div>
            <strong>Row ${i+1}</strong>: ${escapeHtml(row.name || 'Unnamed')}
          </div>
          <div>
            <div>10% (0.1): â‚± ${fmt(markup10)}</div>
            <div>20% (0.2): â‚± ${fmt(markup20)}</div>
            <div>30% (0.3): â‚± ${fmt(markup30)}</div>
          </div>
        `;
        markupContainer.appendChild(markupDiv);
      });
    }

    addRowBtn.addEventListener('click', ()=>{
      rows.push({name:'', pcs:10, desc:'', price:0, materialId: null}); 
      renderRows(); // I-render para lumabas ang bagong row
      // Hindi kailangan i-save dito, i-save ng user pagkatapos mag-input
      computeAll(); // I-compute para ma-update ang totals
    })

    taxInput.addEventListener('input', ()=>{
      computeAll(); 
    })

    if(rows.length===0){ 
      rows = [ 
        {name:'angelo', pcs:10, desc:'', price:100, materialId: null}, 
        {name:'angelo', pcs:12, desc:'', price:100, materialId: null} 
      ]; 
    }
    
    renderRows(); 
    computeAll(); 

    // --- AYOS 1: Pinasimple ang click-outside-to-save.
    // Sine-save na lang nito sa localStorage ang 'rows' array (na updated na).
    document.addEventListener('click', (ev)=>{
      const calculatorCard = rowsContainer.closest('.card');
      
      // Kung sa loob ng calculator card ang click...
      if (ev.target.closest('.card') === calculatorCard) {
         // ...pero *hindi* sa input, button, or select...
         if (!ev.target.matches('input') && !ev.target.matches('button') && !ev.target.matches('select')) {
            // ...I-save sa localStorage.
            localStorage.setItem(ROWS_KEY, JSON.stringify(rows));
         }
      }
    });

  </script>
</body>
</html>
