<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Product Manager & Materials Pricing Calculator</title>
  <style>
    :root {
      --bg: #0e1423;
      --card: rgba(255, 255, 255, 0.03);
      --accent: #6ee7b7;
      --muted: #94a3b8;
      --danger: #ff6b6b;
      --text: #e6eef8;
    }
    * { box-sizing: border-box; }
    body {
      font-family: Inter, sans-serif;
      margin: 0;
      background: linear-gradient(180deg, #071024 0%, #0a1328 100%);
      color: var(--text);
    }
    .wrap { max-width: 1200px; margin: 32px auto; padding: 20px; }
    header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; }
    header h1 { font-size: 20px; margin: 0; }
    header .muted { font-size: 13px; color: var(--muted); }

    .grid { display: grid; gap: 20px; grid-template-columns: 1fr 1fr; }
    @media (max-width: 900px) { .grid { grid-template-columns: 1fr; } }

    .card {
      background: var(--card);
      border: 1px solid rgba(255,255,255,0.05);
      border-radius: 14px;
      padding: 18px;
      box-shadow: 0 6px 18px rgba(2,6,23,0.5);
    }
    .card h2 { margin-top: 0; font-size: 16px; }

    .controls { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 12px; }
    .controls input, select {
      background: rgba(255,255,255,0.04);
      border: 1px solid rgba(255,255,255,0.06);
      color: inherit;
      border-radius: 10px;
      padding: 10px;
      flex: 1;
      min-width: 160px;
    }
    .btn {
      background: linear-gradient(90deg, var(--accent), #3dd6b6);
      border: none;
      padding: 10px 14px;
      border-radius: 10px;
      color: #042018;
      font-weight: 600;
      cursor: pointer;
      transition: opacity 0.2s;
    }
    .btn:hover { opacity: 0.9; }
    .btn.ghost {
      background: transparent;
      border: 1px solid rgba(255,255,255,0.1);
      color: var(--accent);
    }
    .btn.danger {
      background: var(--danger);
      color: #fff;
    }

    .list { max-height: 220px; overflow-y: auto; margin-top: 8px; }
    .item {
      display: flex; align-items: center; justify-content: space-between;
      padding: 10px; background: rgba(255,255,255,0.04);
      border-radius: 10px; margin-bottom: 8px;
    }

    .table { width: 100%; border-collapse: collapse; margin-top: 12px; }
    .table th { text-align: left; color: var(--muted); font-size: 13px; padding-bottom: 8px; }

    .rows { max-height: 320px; overflow-y: auto; margin-top: 10px; }
    .calc-row {
      display: flex; align-items: center; gap: 8px;
      padding: 8px; border-radius: 10px; margin-bottom: 8px;
      background: rgba(255,255,255,0.04);
    }
    .calc-row input, .calc-row select {
      flex: 1; border-radius: 8px; padding: 8px;
      background: transparent; border: 1px solid rgba(255,255,255,0.08); color: inherit;
    }
    .row-actions button { font-size: 13px; padding: 6px 10px; }

    .bottom {
      margin-top: 12px;
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: flex-start;
      gap: 12px;
    }
    .calc-summary {
      background: rgba(255,255,255,0.02);
      padding: 12px;
      border-radius: 10px;
      min-width: 240px;
    }
    .calc-summary div { margin-bottom: 6px; }

    .markup-section {
      background: rgba(255,255,255,0.02);
      padding: 12px;
      border-radius: 10px;
      flex: 1;
    }
    .markup-item { border-bottom: 1px solid rgba(255,255,255,0.06); padding: 6px 0; }
    .markup-item:last-child { border: none; }

    .total-divider { border-top: 1px solid rgba(255,255,255,0.1); margin: 10px 0; }
    footer { text-align: center; color: var(--muted); font-size: 13px; margin-top: 20px; }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>ðŸ›’ Product & Materials Calculator</h1>
        <span class="muted">Auto-save in your browser â€” Dark Glass Design</span>
      </div>
      <div class="chip" style="color: var(--accent); font-size: 13px;">Auto-save: ON</div>
    </header>

    <div class="grid">
      <section class="card">
        <h2>Product Manager</h2>
        <div class="controls">
          <input id="productName" placeholder="Product name (e.g. girl)" />
          <input id="productGSM" type="text" placeholder="GSM (e.g. 180gsm)" />
          <input id="productPrice" type="number" step="0.01" placeholder="Price (â‚±)" />
          <button id="addUpdateBtn" class="btn">Add / Update</button>
          <button id="clearAllBtn" class="btn ghost">Clear</button>
        </div>
        <div style="display:flex;align-items:center;justify-content:space-between;">
          <button id="deleteSelectedBtn" class="btn danger">Delete Selected</button>
          <div class="muted">Total: <span id="totalCount">0</span></div>
        </div>
        <div id="productList" class="list"></div>
      </section>

      <section class="card">
        <h2>ðŸ“˜ Materials Calculator</h2>
        <table class="table">
          <thead>
            <tr>
              <th>Material</th>
              <th>Pcs</th>
              <th>Description</th>
              <th>GSM</th>
              <th>Price</th>
              <th>Per Sheet</th>
              <th></th>
            </tr>
          </thead>
        </table>
        <div id="rowsContainer" class="rows"></div>
        <button id="addRowBtn" class="btn">+ Add Row</button>

        <div class="bottom">
          <div class="calc-summary">
            <div><strong>Total Materials:</strong> â‚± <span id="materialsTotal">0.00</span></div>
            <div><strong>Tax (â‚±):</strong> â‚± <span id="taxDisplay">0.00</span></div>
            <div class="total-divider"></div>
            <div><strong>Total + Tax:</strong> â‚± <span id="totalWithTax">0.00</span></div>
          </div>

          <div class="markup-section">
            <div><strong>Markup Computations</strong></div>
            <div id="markupContainer"></div>
          </div>
        </div>
      </section>
    </div>

    <footer>Built for mobile & desktop Â· Auto-saving Â· Modern layout</footer>
  </div>

  <script>
  const fmt = n => Number(n||0).toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2});
  
  // === PRODUCTS ===
  const PRODUCTS_KEY = "pm_products_v1";
  let products = JSON.parse(localStorage.getItem(PRODUCTS_KEY) || "[]");
  const productName = document.getElementById("productName");
  const productGSM = document.getElementById("productGSM");
  const productPrice = document.getElementById("productPrice");
  const productList = document.getElementById("productList");
  const totalCount = document.getElementById("totalCount");
  const addUpdateBtn = document.getElementById("addUpdateBtn");
  const clearAllBtn = document.getElementById("clearAllBtn");
  const deleteSelectedBtn = document.getElementById("deleteSelectedBtn");
  
  function saveProducts() {
    localStorage.setItem(PRODUCTS_KEY, JSON.stringify(products));
    renderProducts();
    renderRows();
    computeAll();
  }
  
  function renderProducts() {
    productList.innerHTML = "";
    products.forEach((p, i) => {
      const div = document.createElement("div");
      div.className = "item";
      div.innerHTML = `
        <input type="checkbox" data-index="${i}" />
        <div style="flex:1;margin-left:8px;">
          <div><strong>${p.name || "(no name)"}</strong> <span class="muted" style="font-size:12px;">(${p.gsm || "no GSM"})</span></div>
          <div class="muted" style="font-size:13px;">â‚± ${fmt(p.price)}</div>
        </div>
        <button class="btn ghost" data-edit="${i}">Edit</button>
      `;
      productList.appendChild(div);
    });
    totalCount.textContent = products.length;
  
    productList.querySelectorAll("[data-edit]").forEach(btn => {
      btn.onclick = () => {
        const i = btn.dataset.edit;
        productName.value = products[i].name;
        productGSM.value = products[i].gsm || "";
        productPrice.value = products[i].price;
        addUpdateBtn.dataset.editIndex = i;
        addUpdateBtn.textContent = "Update Product";
      };
    });
  }
  
  addUpdateBtn.onclick = () => {
    const name = productName.value.trim();
    const gsm = productGSM.value.trim();
    const price = parseFloat(productPrice.value) || 0;
    if (!name) return alert("Enter product name");
    const data = { name, gsm, price };
    if (addUpdateBtn.dataset.editIndex) {
      products[addUpdateBtn.dataset.editIndex] = data;
      delete addUpdateBtn.dataset.editIndex;
      addUpdateBtn.textContent = "Add / Update";
    } else products.push(data);
    productName.value = productGSM.value = productPrice.value = "";
    saveProducts();
  };
  
  clearAllBtn.onclick = () => {
    if (confirm("Clear all products?")) {
      products = [];
      saveProducts();
    }
  };
  
  deleteSelectedBtn.onclick = () => {
    const checked = [...productList.querySelectorAll("input[type=checkbox]:checked")];
    checked.sort((a,b)=>b.dataset.index - a.dataset.index).forEach(ch => products.splice(ch.dataset.index,1));
    saveProducts();
  };
  
  renderProducts();
  
  // === MATERIALS ===
  const ROWS_KEY = "pm_materials_v1";
  let rows = JSON.parse(localStorage.getItem(ROWS_KEY) || "[]");
  const rowsContainer = document.getElementById("rowsContainer");
  const addRowBtn = document.getElementById("addRowBtn");
  const materialsTotalEl = document.getElementById("materialsTotal");
  const totalWithTaxEl = document.getElementById("totalWithTax");
  const taxDisplay = document.getElementById("taxDisplay");
  const markupContainer = document.getElementById("markupContainer");
  
  let manualTax = 0;
  const taxInput = document.createElement("input");
  taxInput.type = "number";
  taxInput.min = "0";
  taxInput.step = "0.01";
  taxInput.placeholder = "Enter Tax â‚±";
  taxInput.style.cssText = "width:100%;padding:6px;border-radius:6px;margin-top:6px;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.1);color:white;";
  taxDisplay.parentElement.appendChild(taxInput);
  taxInput.oninput = () => { manualTax = parseFloat(taxInput.value) || 0; computeAll(); };
  
  function saveRows() {
    localStorage.setItem(ROWS_KEY, JSON.stringify(rows));
    computeAll();
  }
  
  function computePerSheet(price, pcs) {
    pcs = Number(pcs) || 1;
    return pcs === 0 ? 0 : (Number(price || 0) / pcs);
  }
  
  function renderRows() {
    rowsContainer.innerHTML = "";
    rows.forEach((r, i) => {
      const row = document.createElement("div");
      row.className = "calc-row";
  
      let opts = "";
      products.forEach((p, idx) => {
        opts += `<option value="${p.name}" data-idx="${idx}">â‚±${fmt(p.price)} (${p.gsm || "no GSM"})</option>`;
      });
  
      row.innerHTML = `
        <input list="materialsList${i}" class="r-material" data-i="${i}" value="${r.name || ''}" placeholder="Search or select material">
        <datalist id="materialsList${i}">${opts}</datalist>
  
        <input class="r-pcs" data-i="${i}" type="number" min="0" value="${r.pcs||''}" placeholder="PCS" />
        <input class="r-desc" data-i="${i}" placeholder="Description" value="${r.desc||''}" />
        <input class="r-gsm" data-i="${i}" placeholder="GSM" value="${r.gsm||''}" />
        <input class="r-price" data-i="${i}" type="number" step="0.01" value="${r.price||''}" placeholder="â‚±" />
        <div style="width:90px;font-weight:700;">â‚± <span class="per-sheet">${fmt(computePerSheet(r.price, r.pcs))}</span></div>
        <div class="row-actions">
          <button class="btn ghost small" data-save="${i}">Save</button>
          <button class="btn ghost small" data-del="${i}">Delete</button>
        </div>
      `;
      rowsContainer.appendChild(row);
    });
  
    rowsContainer.querySelectorAll(".r-material").forEach(inp => {
      inp.addEventListener("change", () => {
        const i = inp.dataset.i;
        const prod = products.find(p => p.name.toLowerCase() === inp.value.toLowerCase());
        if (prod) {
          const priceInput = rowsContainer.querySelector(`.r-price[data-i="${i}"]`);
          const gsmInput = rowsContainer.querySelector(`.r-gsm[data-i="${i}"]`);
          priceInput.value = prod.price;
          gsmInput.value = prod.gsm || "";
          rows[i].name = prod.name;
          rows[i].gsm = prod.gsm || "";
          rows[i].price = prod.price;
          rows[i].materialId = products.indexOf(prod);
          saveRows();
          computeAll();
        }
      });
    });
  
    rowsContainer.querySelectorAll("[data-save]").forEach(btn => {
      btn.onclick = () => {
        const i = btn.dataset.save;
        const box = btn.closest(".calc-row");
        rows[i].pcs = Number(box.querySelector(".r-pcs").value) || 0;
        rows[i].desc = box.querySelector(".r-desc").value;
        rows[i].gsm = box.querySelector(".r-gsm").value;
        rows[i].price = Number(box.querySelector(".r-price").value) || 0;
        rows[i].name = box.querySelector(".r-material").value;
        saveRows();
        renderRows();
      };
    });
  
    rowsContainer.querySelectorAll("[data-del]").forEach(btn=>{
      btn.onclick=()=>{
        const i = btn.dataset.del;
        rows.splice(i,1); saveRows(); renderRows();
      };
    });
  }
  
  function computeAll() {
    let total = 0;
    rows.forEach((r,i)=>{
      const per = computePerSheet(r.price, r.pcs);
      total += per;
      const el = rowsContainer.querySelectorAll(".per-sheet")[i];
      if(el) el.textContent = fmt(per);
    });
  
    const tax = manualTax;
    taxDisplay.textContent = fmt(tax);
    const grand = total + tax;
    materialsTotalEl.textContent = fmt(total);
    totalWithTaxEl.textContent = fmt(grand);
    computeMarkupForAll(total, tax);
  }
  
  function computeMarkupForAll(total, tax){
    markupContainer.innerHTML = "";
    if(rows.length===0){ markupContainer.innerHTML = '<div class="muted">No rows</div>'; return; }
    let total10=0,total20=0,total30=0;
    rows.forEach((r,i)=>{
      const base = computePerSheet(r.price, r.pcs);
      const name = r.name || "Unnamed";
      const m10 = base*1.1, m20 = base*1.2, m30 = base*1.3;
      total10+=m10; total20+=m20; total30+=m30;
      const div=document.createElement("div");
      div.className="markup-item";
      div.innerHTML = `
        <div>${name}: </div>
        <div>10%: â‚±${fmt(m10)} | 20%: â‚±${fmt(m20)} | 30%: â‚±${fmt(m30)}</div>
      `;
      markupContainer.appendChild(div);
    });
  }
  
  addRowBtn.onclick = () => {
    rows.push({ name:"", pcs:"", desc:"", price:"", materialId:null });
    renderRows();
    saveRows();
  };
  
  renderRows();
  computeAll();
  </script>
</body>
</html>
